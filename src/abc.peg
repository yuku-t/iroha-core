{
  var AbcFile = require("./AbcFile").AbcFile
    , AbcTune = require("./AbcTune").AbcTune
    , TuneHeader = require("./TuneHeader").TuneHeader
    , TuneBody = require("./TuneBody").TuneBody;
}

Start
  = AbcFile

AbcFile
  = abcTune:AbcTune { return new AbcFile(abcTune); }

AbcTune
  = tuneHeader:TuneHeader tuneBody:TuneBody { return new AbcTune(tuneHeader, tuneBody); }

TuneHeader
  = ReferenceNumberField TitleField InformationField* { return new TuneHeader(); }

InformationField
  = ComposerField
  / KeyField
  / MeterField

ComposerField
  = "C:" TextString Linefeed

KeyField
  = "K:" TextString Linefeed

MeterField
  = "M:" TextString Linefeed

TitleField
  = "T:" TextString Linefeed

ReferenceNumberField
  = "X:" Number Linefeed

TuneBody
  = TuneLine+ { return new TuneBody(); }

TuneLine
  = Element+ Linefeed?

Element
  = NotesGroup
  / BarLine
  / Space

NotesGroup
  = NoteElement+

NoteElement
  = Note NoteLength?

Note
  = [a-gA-G]

NoteLength
  = Number? ("/"+ Number?)?

BarLine
  = "|:"
  / ":|"
  / "|"

Linefeed
  = "\r\n" / "\n"

Space
  = [ \t]

TextString
  = TextChar*

TextChar
  = [^\n]

Number
  = [0-9]+
